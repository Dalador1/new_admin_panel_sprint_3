#------------------------------------------------------------------------------
# FILE LOCATIONS
#------------------------------------------------------------------------------

data_directory = '/var/lib/postgresql/data' # Расположение данных
hba_file = '/var/lib/postgresql/data/pg_hba.conf' # Файл pg_hba.conf
ident_file = '/var/lib/postgresql/data/pg_ident.conf' # Файл pg_ident.conf

#------------------------------------------------------------------------------
# CONNECTIONS AND AUTHENTICATION
#------------------------------------------------------------------------------

listen_addresses = '*'         # Слушать на всех IP-адресах
port = 5432                    # Стандартный порт PostgreSQL
max_connections = 100          # Максимальное количество соединений

#------------------------------------------------------------------------------
# RESOURCE USAGE
#------------------------------------------------------------------------------

shared_buffers = 128MB         # Память для буферов
work_mem = 4MB                 # Память на операцию сортировки/хэширования
maintenance_work_mem = 64MB    # Память для операций VACUUM/CREATE INDEX
effective_cache_size = 4GB     # Предполагаемый объем доступного кэша ОС
dynamic_shared_memory_type = posix

#------------------------------------------------------------------------------
# WRITE-AHEAD LOG
#------------------------------------------------------------------------------

wal_level = logical             # Уровень WAL для логической репликации
fsync = on                      # Гарантия записи данных на диск
synchronous_commit = off        # Ускорение за счет отключения синхронного коммита
wal_sync_method = fsync         # Метод синхронизации WAL
full_page_writes = on           # Полные страницы для восстановления после ошибок записи
wal_buffers = 16MB              # Размер буферов для WAL
wal_writer_delay = 200ms        # Задержка записи WAL в миллисекундах
wal_writer_flush_after = 1MB    # Порог записи WAL на диск

# - Checkpoints -

checkpoint_timeout = 10min      # Частота выполнения контрольных точек
checkpoint_completion_target = 0.9 # Доля времени между контрольными точками для выполнения
max_wal_size = 1GB              # Максимальный размер WAL перед контрольной точкой
min_wal_size = 80MB             # Минимальный размер WAL

# - Replication -

max_wal_senders = 4             # Максимальное количество процессов отправки WAL
max_replication_slots = 4       # Максимальное количество слотов репликации
wal_keep_size = 256MB           # Хранение до 256MB WAL для репликации

#------------------------------------------------------------------------------
# REPLICATION
#------------------------------------------------------------------------------

# Настройки для подписчиков
hot_standby = on                # Включение режима горячего стендбая
max_logical_replication_workers = 4 # Логическая репликация
max_sync_workers_per_subscription = 2 # Работники для подписки

#------------------------------------------------------------------------------
# LOGGING
#------------------------------------------------------------------------------

logging_collector = on          # Включить сборщик логов
log_directory = '/var/lib/postgresql/data/log' # Директория для логов
log_filename = 'postgresql.log' # Имя файла лога
log_statement = 'ddl'           # Логировать только DDL-запросы
log_min_duration_statement = 1000 # Логировать запросы дольше 1 секунды
log_timezone = 'Etc/UTC'

#------------------------------------------------------------------------------
# CLIENT CONNECTION DEFAULTS
#------------------------------------------------------------------------------

datestyle = 'iso, mdy'          # Формат даты
timezone = 'Etc/UTC'            # Часовой пояс
lc_messages = 'en_US.utf8'      # Язык сообщений
lc_monetary = 'en_US.utf8'      # Формат валюты
lc_numeric = 'en_US.utf8'       # Формат чисел
lc_time = 'en_US.utf8'          # Формат времени
default_text_search_config = 'pg_catalog.english'

#------------------------------------------------------------------------------
# AUTOVACUUM
#------------------------------------------------------------------------------

autovacuum = on                 # Включить автoвакуум
autovacuum_max_workers = 3      # Количество процессов автообслуживания
autovacuum_naptime = 1min       # Интервал между запусками автoвакуума
autovacuum_vacuum_threshold = 50 # Минимальное количество обновлений строк
autovacuum_analyze_threshold = 50 # Минимальное количество обновлений строк для анализа

#------------------------------------------------------------------------------
# CUSTOMIZED OPTIONS
#------------------------------------------------------------------------------

# Добавьте настройки для расширений здесь, если нужно